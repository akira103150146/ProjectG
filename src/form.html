<html>
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="css/form.css" type="text/css" media="screen" />
    <link rel="stylesheet" href="css/sidebar.css" type="text/css" media="screen" />
    <link href="../../node_modules/jquery-contextmenu/dist/jquery.contextMenu.css" rel="stylesheet" type="text/css" />
    <script src="../../node_modules/jquery/dist/jquery.min.js"></script>
    <script src="js/lib/jqueryImporter.js"></script>
    <script type="text/javascript" src="js/lib/header.js"></script>
    <script type="text/javascript" src="js/lib/redips-table-min.js"></script>
    <script type="text/javascript" src="js/lib/script.js"></script>
    <script src="../../node_modules/jquery-contextmenu/dist/jquery.contextMenu.js" type="text/javascript"></script>
    <script src="js/app/sidebar.js"></script>
    <script>
        "use strict";
        var ipcrender = require('electron').ipcRenderer
        ipcrender.on('reply-form',function (event, info){
            localStorage.list_form = JSON.stringify(info)//將傳入list存入local     
            redips.showlist(info)
        })
        ipcrender.on('update-form',function(event, content,tag){
            ipcrender.send('ready-to-show', 'form')
        })
        ipcrender.on('bind_devices', function (event, arg) {
               //console.log(arg.toString())
                var includes = function (e) {//用來判斷是否有重複存在的ID
                    let arr =  $('#bind-list li')
                    for(let i = 0;i<arr.length;i++){
                        if(arr[i].textContent == e)return true
                    }  
                    return false                     
                }
                for(var i =0;i<arg.length;i++){                   
                    if(!includes(arg[i])){//如果綁定的ID不存在的話就加入li
                        //console.log('e')
                      let temp = document.createElement('li')
                      temp.textContent = arg[i]
                      $('#bind-list').append(temp)
                    }
                }             

        })
        $(document).ready(function () {
            ipcrender.send('ready-to-show', 'form')
            sidebar_setup('form')
            $('#form-list').change(function () {
                console.log($('#form-list :selected'))
                const index = $('#form-list :selected')[0].id
                //console.log(index)
                redips.update_to_json(redips.current_select_form_index, redips.get_loc_formdata())//將local編輯的結果儲存下來 
                redips.showform(index)
                redips.current_select_form_index = index
            });
        });
      
        $(function () {
            $('#mainTable').contextMenu({
                selector: 'td',
                items: {
                    "SetToNotChangeAble": {
                        name: "設為不可填", icon: "edit", callback: function () {
                            $(this)[0].contentEditable = false;
                        }
                    },
                    "SetToChangeAble": {
                        name: "設為可填", icon: "edit", callback: function () {
                            $(this)[0].contentEditable = true;
                        }
                    },
                    "add": {
                        name: "新增", icon: "paste",
                        items: {
                            "checkbox": {
                                name: "勾選格", callback: function () {
                                    let i = document.createElement('INPUT');
                                    i.setAttribute("type", "checkbox");
                                    $(this).append(i);
                                }
                            },
                            "image": {
                                name: "圖片上傳", callback: function () {
                                    let i = document.createElement('INPUT');
                                    i.setAttribute("type", "file");
                                    $(this).append(i);
                                }
                            }
                        }
                    },
                    "delete": { name: "Delete", icon: "delete" },
                    "sep1": "---------",
                    "quit": { name: "Quit", icon: function ($element, key, item) { return 'context-menu-icon context-menu-icon-quit'; } }
                }
            });
        });
      
    </script>
  
</head>

<body>
    <div class="wrapper">
        <nav id="sidebar">
            <div class="sidebar-header">
                <h3 id="close_btn">Close &times;</h3>
                <h3 id="user-name">AKIRA</h3>
                <button id="logout_btn">登出</button>
            </div>
        <ul id="sidebar-option">
        </ul>
        </nav>
        <div id="myContainer">
            <button type="button" id="sidebarCollapse" class="btn btn-info navbar-btn">
                <i class="glyphicon glyphicon-align-left"></i>
                ☰
            </button>

            <select id="form-list">
            </select>

            <table id="toolbox">
                <tbody>
                    <tr>
                        <td>
                            <input type="button" value="合併儲存格" class="button" onclick="redips.merge()" title="Merge marked table cells horizontally and verically"
                            />
                        </td>
                        <td>
                            <input type="button" value="水平分割儲存格" class="button" onclick="redips.split('h')" title="Split marked table cell horizontally"
                            />
                            <input type="button" value="垂直分割儲存格" class="button" onclick="redips.split('v')" title="Split marked table cell vertically"
                            />
                        </td>
                        <td>
                            <input type="button" value="新增列" class="button" onclick="redips.row('insert')" title="Add table row" />
                            <input type="button" value="刪除列" class="button" onclick="redips.row('delete')" title="Delete table row" />
                        </td>
                        <td>
                            <input type="button" value="新增行" class="button" onclick="redips.column('insert')" title="Add table column" />
                            <input type="button" value="刪除行" class="button" onclick="redips.column('delete')" title="Delete table column" />
                        </td>
                        <td>
                            <input type="button" value="新增表格" class="button" onclick="redips.addform()" title="Add Form" />
                            <input type="button" value="儲存表格" class="button" onclick="redips.saveform()" title="Save change" />
                            <input type="button" value="刪除表格" class="button" onclick="redips.removeform()" title="Remove Form" />
                        </td>
                        <td>
                            <input type="button" value="綁定表單" class="button" onclick="redips.bind_device()" title="Remove Form" />
                        </td>
                    </tr>
                </tbody>
            </table>
            <div class="form_attribute">
                ID
                <input type="text" id="ID" value="" disabled /> 
                標題
                <input type="text" id="title" value="" /> 
                創建日期
                <input type="text" id="date" value="" disabled />
                <ul id="bind-list">
                </ul>
            </div>
            <table id="mainTable">
                <tbody>
                    <tr>
                        <td contenteditable="true"></td>
                        <td contenteditable="true"></td>
                        <td contenteditable="true"></td>
                        <td contenteditable="true"></td>
                        <td contenteditable="true"></td>
                        <td contenteditable="true"></td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</body>

</html>